[%# This Source Code Form is subject to the terms of the Mozilla Public
  # License, v. 2.0. If a copy of the MPL was not distributed with this
  # file, You can obtain one at http://mozilla.org/MPL/2.0/.
  #
  # This Source Code Form is "Incompatible With Secondary Licenses", as
  # defined by the Mozilla Public License, v. 2.0.
  #%]

[% ################################################# %]
[% #   LMB Hack - include file for ipi terms       # %]
[% #################################################%]

[% PROCESS "ipi/variables.ipi.tmpl" %]

[% ################################################# %]
[% #   END LMB Hack - include file for ipi terms   # %]
[% #################################################%]

[% PROCESS bug/time.html.tmpl %]

[% IF Param('comment_taggers_group') %]
  [% IF user.can_tag_comments %]
    <div id="bz_ctag_div" class="bz_default_hidden">
      <a href="javascript:void(0)" onclick="YAHOO.bugzilla.commentTagging.hideInput()">x</a>
        <div>
          <input id="bz_ctag_add" size="10" placeholder="add tag"
           maxlength="[% constants.MAX_COMMENT_TAG_LENGTH FILTER html %]">
          <span id="bz_ctag_autocomp"></span>
        </div>
        &nbsp;
    </div>
    <div id="bz_ctag_error" class="bz_default_hidden">
      <a href="javascript:void(0)" onclick="YAHOO.bugzilla.commentTagging.hideError()">x</a>
      <span id="bz_ctag_error_msg"></span>
    </div>
  [% END %]
  [% IF user.id %]
    <script type="text/javascript">
      YAHOO.bugzilla.commentTagging.init([% user.can_tag_comments ? 'true' : 'false' %]);
      YAHOO.bugzilla.commentTagging.min_len = [% constants.MIN_COMMENT_TAG_LENGTH FILTER js %];
      YAHOO.bugzilla.commentTagging.max_len = [% constants.MAX_COMMENT_TAG_LENGTH FILTER js %];
      YAHOO.bugzilla.commentTagging.label = 'Comment Tags:';
      YAHOO.bugzilla.commentTagging.min_len_error =
        'Comment tags must be at least
        [%~ " " _ constants.MIN_COMMENT_TAG_LENGTH FILTER js %] characters.';
      YAHOO.bugzilla.commentTagging.max_len_error =
        'Comment tags cannot be longer than
        [%~ " " _ constants.MAX_COMMENT_TAG_LENGTH FILTER js %] characters.';
    </script>
  [% END %]
[% END %]

<script type="text/javascript">
	<!--
	[% IF user.is_timetracker %]
	  var bz_remaining_time = [% bug.remaining_time %];
	[% END %]

	[% IF user.id %]
	  /* Index all classifications so we can keep track of the classification
	   * for the selected product, which could control field visibility.
	   */
	  var all_classifications = new Array([% bug.choices.product.size %]);
	  [%- FOREACH product = bug.choices.product %]
		  all_classifications['[% product.name FILTER js %]'] = '
			  [%- product.classification.name FILTER js %]';
	  [%- END %]
	[% END %]
	//-->
</script>


[%############################################################################%]
[%# This is where we can organize the display order                          #%]
[%# Not all the display option are modified there                            #%]
[%# some are in the Preferences in the BZ interface                          #%]
[%# some are linked to the sortkey of the field (custom fields)              #%]
[%# some are linked to the CSS class and the custom field naming convention  #%]
[%############################################################################%]


<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

	<input type="hidden" name="delta_ts" value="[% bug.delta_ts %]">
	<input type="hidden" name="id" value="[% bug.bug_id %]">
	<input type="hidden" name="token" value="[% issue_hash_token([bug.id, bug.delta_ts]) FILTER html %]">	

    [% PROCESS section_title %]
    <div class="row edit_form">
		<div class="row static-children">
			<div id="bz_show_bug_column_1" class="bz_show_bug_column">

				<div class="row">
				[%# 1st row - 1 block 12 width %]  
				[%############################################################################%]
				[%# All the elements below this are not collapsible                          #%]
				[%############################################################################%]
					<div class="col-md-12">
							<div class="bug-field-grid bz_field_lmb_not_broken">
								[% PROCESS section_status %]
							</div>
							<div class="bug-field-grid bz_field_lmb_not_broken">
								[% PROCESS section_people %]
							</div>
							<div class="bug-field-grid bz_field_lmb_not_broken">
								[% PROCESS section_product %]
							</div>
							<div class="bug-field-grid bz_field_lmb_not_broken">
								[% PROCESS section_component %]
							</div>
					</div>
				</div>
				
				<div class="row">
				[%# 2nd row 2 blocks 8 and 4 width %]			
				[%############################################################################%]
				[%# All the elements below this are collapsible (default open)               #%]
				[%############################################################################%]				
					<div class="col-md-8">
						<div class="bug-field-grid collapse-controller">
						  <a href="javascript:void(0);" data-toggle="collapse" data-target="#basic-information-group" class="default-open" style="display:inherit;">Overview of the claim</a>
						</div>
						<div id="basic-information-group" class="collapse in">
							<div class="col-md-5">
								<div class="bug-field-grid">
									[% PROCESS section_aliases %]
								</div>
								<div class="bug-field-grid">
									[% PROCESS section_deadline %]
								</div>
								<div class="bug-field-grid">
									[% PROCESS section_importance %]
								</div>
								[% PROCESS section_target_milestone %]
								<div class="bug-field-grid bz_field_platform">
									[% PROCESS section_platform %]
								</div>
								<div class="bug-field-grid">
									[% PROCESS section_customfields_with_keyword_clust_6 %]
								</div>
							</div>
							<div class="col-md-7">
								<div class="row">
									<div class="col-md-5">
										<div class="bug-field-grid">
										[% PROCESS section_customfields_with_keyword_clust_2 %]
										</div>
									</div>
									<div class="col-md-7">
										<div class="bug-field-grid">
										[% PROCESS section_opsys %]
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										[% PROCESS section_customfields_with_keyword_clust_8 %]
										<div class="bug-field-grid bz_field_lmb_not_broken">
											[%# we do not use version - commented out %]
											[%# PROCESS section_version %]
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					[%############################################################################%]
					[%# All the elements below this are collapsible (default open)               #%]
					[%############################################################################%]
					
					<div class="col-md-4">				
						[% PROCESS section_customfields_with_keyword_clust_1 %]
					</div>
				</div>
				
				[%# 3rd row 4 blocks 4, 4/4 and 4 width %]
				[%############################################################################%]
				[%# All the elements below this are collapsible (default open)               #%]
				[%############################################################################%]
				<div class="row">
					<div class="col-md-3">
						[% PROCESS section_customfields_with_keyword_clust_3 %]
					</div>
					<div class="col-md-5">
						[% PROCESS section_customfields_with_keyword_clust_5 %]
						[% PROCESS section_customfields_with_keyword_clust_7 %]
					</div>
					<div class="col-md-4">
						[% PROCESS section_customfields_with_keyword_clust_9 %]
					</div>
				</div>
				
				[%# 6th row 4 blocks 3 each %]
				[%############################################################################%]
				[%# All the elements below this are collapsible (default open)               #%]
				[%############################################################################%]
				<div class="row">				
					<div class="col-md-4">
						[%############################################################################%]
						[%# Collapsible group for the claims related to this claim                   #%]
						[%############################################################################%]
						<div class="bug-field-grid collapse-controller">
						  <a href="javascript:void(0);" data-toggle="collapse" data-target="#relations-with-other-claims" class="default-open" style="display:inherit;">Relations to other claims</a>
						</div>
						<div id="relations-with-other-claims" class="collapse in">			
							[% PROCESS section_duplicates %]
							<div class="bug-field-grid bz_field_lmb_not_broken">				
								[% PROCESS section_dependson %]			
							</div>
							<div class="bug-field-grid bz_field_lmb_not_broken">
								[% PROCESS section_blocks %]
							</div>
							<div class="bug-field-grid bz_field_lmb_not_broken">
								[% PROCESS section_dependency %]
							</div>
							[% PROCESS section_see_also %]
						</div>
					</div>								
					<div class="col-md-4">						
						<div class="bug-field-grid collapse-controller">
							<a href="javascript:void(0);" data-toggle="collapse" data-target="#time-tracking-group" class="default-open" style="display:inherit;">Time Trackings</a>
						</div>
						<div id="time-tracking-group" class="collapse in">		  
							[% PROCESS section_timetracking %]
						</div>					
					</div>
					<div class="col-md-4">
						<div class="bug-field-grid collapse-controller">
						  <a href="javascript:void(0);" data-toggle="collapse" data-target="#who-group" class="default-open" style="display:inherit;">History and Stakeholder(s) involved</a>
						</div>
						<div id="who-group" class="collapse in">
							<div class="bug-field-grid bz_field_reported">
								[% PROCESS section_dates %]
							</div>
							<div class="bug-field-grid">
								[% PROCESS section_cclist %]
							</div>
							[% PROCESS section_bug_ignored %]
						</div>
					</div>		
				</div>
				
				[%# 4th row 2 blocks 6 and 6 width %]
				[%############################################################################%]
				[%# All the elements below this are collapsible (default open)               #%]
				[%############################################################################%]
				<div class="row">				
					<div class="col-md-6">
						<div class="bug-field-grid collapse-controller">
						  <a href="javascript:void(0);" data-toggle="collapse" data-target="#flags" class="default-open" style="display:inherit;">Flags and approval request</a>
						</div>
						<div id="flags" class="collapse in ">					  
							<div class="bug-field-grid">
								[% PROCESS section_flags %]	
							</div>
						</div>
					</div>
					<div class="col-md-6">
						[%############################################################################%]
						[%# Collapsible group for attachments                                        #%]
						[%############################################################################%]
						
						<div class="bug-field-grid collapse-controller">
							<a href="javascript:void(0);" data-toggle="collapse" data-target="#attachments-for-this-claim" class="default-open" style="display:inherit;">Attachments for this claim</a>
						</div>
						<div id="attachments-for-this-claim" class="collapse in">	
							[% PROCESS section_attachments %]
						</div>
					</div>
				</div>
				
				[%# 5th row 1 blocks 12 each %]
				[%############################################################################%]
				[%# All the elements below this are collapsible (default open)               #%]
				[%############################################################################%]
				<div class="row">
					<div class="col-md-12 bz_show_bug_column">
						[% PROCESS section_customfields %]
						[% Hook.process("after_custom_fields") %]
					</div>
				</div>
				<div class="row">				
					<div class="col-md-6">
						<div class="bug-field-grid collapse-controller">
						  <a href="javascript:void(0);" data-toggle="collapse" data-target="#more_details" class="default-close" style="display:inherit;">URL, Keywords, Tags</a>
						</div>
						<div id="more_details" class="collapse">						  
							<div class="bug-field-grid">
								[% PROCESS section_url %]
								[% PROCESS section_keyword %]
								[% PROCESS section_whiteboard %]
								[% PROCESS section_tags %]
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="bug-field-grid collapse-controller">
							<a href="javascript:void(0);" data-toggle="collapse" data-target="#manage-visibility-group" class="default-close" style="display:inherit;">Manage Visibility</a>
						</div>
						<div id="manage-visibility-group" class="collapse">
							<div class="bz_group_visibility_section">				
								[% PROCESS section_restrict_visibility %]
							</div>
						</div>
					</div>
				</div>				
			</div>	  
		</div>
	</div>
	<div id="bz_big_form_parts" class="row">
		<div class="row static-children">
			<div class="col-md-12">
			
			[%############################################################################%]
			[%# The comments section                                                     #%]
			[%############################################################################%]		
				
				[% IF user.settings.comment_box_position.value == 'before_comments' %]
				<div id="add_comment" class="bz_section_additional_comments">
					[% PROCESS comment_box %]
				</div>
				[% END %]
				<hr>
				<div id="comments">
				  [% PROCESS bug/comments.html.tmpl
					comments = bug.comments
					mode = user.id ? "edit" : "show"
				  %]
				</div>
					
				[% IF user.settings.comment_box_position.value == 'after_comments' %]
				<hr>
				<div id="add_comment" class="bz_section_additional_comments">
					[% PROCESS comment_box %]
				</div>
				[% END %]
				
   			[%############################################################################%]
			[%# END The comments section                                                 #%]
			[%############################################################################%]		
				
			</div>        
		</div>
	</div>
</form>

[%############################################################################%]
[%# END This is where we can organize the display order                      #%]
[%############################################################################%]
	 
	[%################################################################################%]
	[%# no need for a to half spacer (this should be in a section too BTW...         #%]
	[%################################################################################%]   
	<!--
		<div class="row">
		  <hr id="bz_top_half_spacer">
		</div>
	-->	
	[%################################################################################%]
	[%# END no need for a to half spacer (this should be in a section too BTW...     #%]
	[%################################################################################%] 

[%############################################################################%]
[%# This is where we define the blocks that we need                          #%]
[%############################################################################%]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_1                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_1 %]
		[% USE Bugzilla %]
		[% clust_1Found = 0 %]
			[% FOREACH field = Bugzilla.active_custom_fields %]
				[% IF field.name.search('clust_1') %]
					[% clust_1Found = 1 %]
				[% END %]
			[% END %]
			[% IF clust_1Found %]
				<div class="bug-field-grid collapse-controller">
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#clust_1" class="default-open" style="display:inherit;">The Solution</a>
				</div>
				<div id="clust_1" class="collapse in">
			[% END %]
			[% FOREACH field = Bugzilla.active_custom_fields %]
				[% IF field.name.search('clust_1') %]
					<div class="bug-field-grid [%- field.name %]">
						[%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
							# in the template and must be returned back. INCLUDE cannot do that. %]
						[% PROCESS bug/field.html.tmpl value = bug.${field.name}
												editable = bug.check_can_change_field(field.name, 0, 1) %]
					</div>
				[% IF extra_field_item %]
					<div class="bug-field-grid">
						<span class="field_label">[% extra_field_item.header FILTER none %]</span>
						[% extra_field_item.data FILTER none %]
					</div>
				[% END %]
			[% END %]
		[% END %]
		[% IF clust_1Found %]
				</div>
		[% END %]
	 [% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_2                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_2 %]
		[% USE Bugzilla %]
		[% FOREACH field = Bugzilla.active_custom_fields %]
			[% IF field.name.search('clust_2') %]
				<div class="bug-field-grid [%- field.name %] bz_field_lmb_not_broken">
					[%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
						# in the template and must be returned back. INCLUDE cannot do that. %]
					[%# By default, it is PROCESS, but there is a weird behavior in PROCESS which seems to affect the next immediate field. So we decided to use INCLUDE as workaround. Need to understand how both PROCESS and INCLUDE work. %]
					[% INCLUDE bug/field.html.tmpl value = bug.${field.name}
										 editable = bug.check_can_change_field(field.name, 0, 1) %]
				</div>
			[% END %]
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_3                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_3 %]
		[% USE Bugzilla %]
		[% clust_3Found = 0 %]
		[% FOREACH field = Bugzilla.active_custom_fields %]
			[% IF field.name.search('clust_3') %]
				[% clust_3Found = 1 %]
			[% END %]
		[% END %]
		[% IF clust_3Found %]
			<div class="bug-field-grid collapse-controller">
			  <a href="javascript:void(0);" data-toggle="collapse" data-target="#clust_3" class="default-open" style="display:inherit;">Actions on the Field</a>
			</div>
			<div id="clust_3" class="collapse in">
		[% END %]
	    [% FOREACH field = Bugzilla.active_custom_fields %]
			[% IF field.name.search('clust_3') %]
				<div class="bug-field-grid [%- field.name %] bz_field_lmb_not_broken">
				[%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
					# in the template and must be returned back. INCLUDE cannot do that. %]
				[% PROCESS bug/field.html.tmpl value = bug.${field.name}
										 editable = bug.check_can_change_field(field.name, 0, 1) %]
				</div>
				[% IF extra_field_item %]
					<div class="bug-field-grid">
						<span class="field_label">[% extra_field_item.header FILTER none %]</span>
						[% extra_field_item.data FILTER none %]
					</div>
				[% END %]
			[% END %]
		[% END %]
		[% IF clust_3Found %]
		</div>
		[% END %]

	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_4                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_4 %]
	  [% USE Bugzilla %]
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_4') %]
			<div class="bug-field-grid [%- field.name %]">
				[%# Use PROCESS instead of INCLUDE, because extra_field_item is defined  %]
				[%# in the template and must be returned back. INCLUDE cannot do that. %]
				[%# By default, it is PROCESS, but there is a weird behavior in PROCESS which seems to affect the next immediate field. %]
				[%# So we decided to use INCLUDE as workaround. Need to understand how both PROCESS and INCLUDE work. %]
				[% INCLUDE bug/field.html.tmpl value = bug.${field.name}
											 editable = bug.check_can_change_field(field.name, 0, 1) %]
			</div>
		[% END %]
	  [% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_5                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_5 %]
	  [% USE Bugzilla %]
	  [% clust_5Found = 0 %]
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_5') %]
		  [% clust_5Found = 1 %]
		[% END %]
	  [% END %]
	  [% IF clust_5Found %]
		<div class="bug-field-grid collapse-controller">
		  <a href="javascript:void(0);" data-toggle="collapse" data-target="#clust_5" class="default-open" style="display:inherit;">Purchases and Contractors</a>
		</div>
		<div id="clust_5" class="collapse in">
	  [% END %]
	  
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_5') %]
		  <div class="bug-field-grid [%- field.name %]">
		  [%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
			# in the template and must be returned back. INCLUDE cannot do that. %]
		  [% PROCESS bug/field.html.tmpl value = bug.${field.name}
										 editable = bug.check_can_change_field(field.name, 0, 1) %]
		  </div>
		  [% IF extra_field_item %]
			<div class="bug-field-grid">
			  <span class="field_label">[% extra_field_item.header FILTER none %]</span>
			  [% extra_field_item.data FILTER none %]
			</div>
		  [% END %]
		[% END %]
	  [% END %]
	  
	  [% IF clust_5Found %]
		</div>
	  [% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_6                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_6 %]
	  [% USE Bugzilla %]
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_6') %]
		  <div class="bug-field-grid [%- field.name %]">
		  [%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
			# in the template and must be returned back. INCLUDE cannot do that. %]
		  [% PROCESS bug/field.html.tmpl value = bug.${field.name}
										 editable = bug.check_can_change_field(field.name, 0, 1) %]
		  </div>
		  [% IF extra_field_item %]
			<div class="bug-field-grid">
			  <span class="field_label">[% extra_field_item.header FILTER none %]</span>
			  [% extra_field_item.data FILTER none %]
			</div>
		  [% END %]
		[% END %]
	  [% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_7                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_7 %]
	  [% USE Bugzilla %]
	  [% clust_7Found = 0 %]
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_7') %]
		  [% clust_7Found = 1 %]
		[% END %]
	  [% END %]
	  [% IF clust_7Found %]
		<div class="bug-field-grid collapse-controller">
		  <a href="javascript:void(0);" data-toggle="collapse" data-target="#clust_7" class="default-open" style="display:inherit;">Payments</a>
		</div>
		<div id="clust_7" class="collapse in">
	  [% END %]
	  
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_7') %]
		  <div class="bug-field-grid [%- field.name %]">
		  [%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
			# in the template and must be returned back. INCLUDE cannot do that. %]
		  [% PROCESS bug/field.html.tmpl value = bug.${field.name}
										 editable = bug.check_can_change_field(field.name, 0, 1) %]
		  </div>
		  [% IF extra_field_item %]
			<div class="bug-field-grid">
			  <span class="field_label">[% extra_field_item.header FILTER none %]</span>
			  [% extra_field_item.data FILTER none %]
			</div>
		  [% END %]
		[% END %]
	  [% END %]
	  
	  [% IF clust_7Found %]
		</div>
	  [% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_8                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_8 %]
		[% USE Bugzilla %]
		[% FOREACH field = Bugzilla.active_custom_fields %]
			[% IF field.name.search('clust_8') %]
				<div class="bug-field-grid [%- field.name %] bz_field_lmb_not_broken">
					[%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
						# in the template and must be returned back. INCLUDE cannot do that. %]
					[%# By default, it is PROCESS, but there is a weird behavior in PROCESS which seems to affect the next immediate field. So we decided to use INCLUDE as workaround. Need to understand how both PROCESS and INCLUDE work. %]
					[% INCLUDE bug/field.html.tmpl value = bug.${field.name}
										 editable = bug.check_can_change_field(field.name, 0, 1) %]
				</div>
			[% END %]
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields with keyword clust_9                             #%]
	[%############################################################################%]

	[% BLOCK section_customfields_with_keyword_clust_9 %]
	  [% USE Bugzilla %]
	  [% clust_9Found = 0 %]
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_9') %]
		  [% clust_9Found = 1 %]
		[% END %]
	  [% END %]
	  [% IF clust_9Found %]
		<div class="bug-field-grid collapse-controller">
		  <a href="javascript:void(0);" data-toggle="collapse" data-target="#clust_9" class="default-open" style="display:inherit;">Bill back to LL or Customer</a>
		</div>
		<div id="clust_9" class="collapse in">
	  [% END %]
	  
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF field.name.search('clust_9') %]
			<div class="bug-field-grid [%- field.name %]">
				[%# Use PROCESS instead of INCLUDE, because extra_field_item is defined  %]
				[%# in the template and must be returned back. INCLUDE cannot do that. %]
				[%# By default, it is PROCESS, but there is a weird behavior in PROCESS which seems to affect the next immediate field. %]
				[%# So we decided to use INCLUDE as workaround. Need to understand how both PROCESS and INCLUDE work. %]
				[% INCLUDE bug/field.html.tmpl value = bug.${field.name}
							 editable = bug.check_can_change_field(field.name, 0, 1) %]
			</div>
		  [% IF extra_field_item %]
			<div class="bug-field-grid">
			  <span class="field_label">[% extra_field_item.header FILTER none %]</span>
			  [% extra_field_item.data FILTER none %]
			</div>
		  [% END %]
		[% END %]
	  [% END %]
	  
	  [% IF clust_9Found %]
		</div>
	  [% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for attachments                                                    #%]
	[%############################################################################%]
	
	[% BLOCK section_attachments %]			  	
		[% PROCESS attachment/list.html.tmpl
		   attachments = bug.attachments
			   bugid       = bug.bug_id
			   num_attachment_flag_types = bug.num_attachment_flag_types
			   show_attachment_flags = bug.show_attachment_flags
		%]
	[% END %]
			
	[%############################################################################%]
	[%# END Collapsible group for attachments                                    #%]
	[%############################################################################%]

	[%############################################################################%]
	[%# Block for Restricting Visibility                                         #%]
	[%############################################################################%]

	[% BLOCK section_restrict_visibility %]
		[% RETURN UNLESS bug.groups.size %]
		  
		  [% inallgroups = 1 %]
		  [% inagroup = 0 %]
		  [% emitted_description = 0 %]

		  [% FOREACH group = bug.groups %]
			[% SET inallgroups = 0 IF NOT group.ingroup %]
			[% SET inagroup = 1 IF group.ison %]

			[% NEXT IF group.mandatory %]

			[% IF NOT emitted_description %]
			  [% emitted_description = 1 %]
				<div id="bz_restrict_group_visibility_help">
				  <b>Only users in
					[%+ IF Param('or_groups') %]at least one[% ELSE %]all[% END %]
					of the selected groups can view this [% terms.bug %]:</b>
				   <p class="instructions">
					 Unchecking all boxes makes this a more public [% terms.bug %].
				   </p>
				</div>
			[% END %]

			[% IF group.ingroup %]
			  <input type="hidden" name="defined_groups" 
					 value="[% group.name FILTER html %]">
			[% END %]

			<input type="checkbox" value="[% group.name FILTER html %]"
				   name="groups" id="group_[% group.bit %]"
				   [% ' checked="checked"' IF group.ison %]
				   [% ' disabled="disabled"' IF NOT group.ingroup %]>
			<label for="group_[% group.bit %]">
			[%- group.description FILTER html_light %]</label>
			<br>
		  [% END %]

		  [% IF emitted_description %]
			[% IF NOT inallgroups %]
			  <p class="instructions">Only members of a group can change the 
				visibility of [% terms.abug %] for that group.</p>
			[% END %]
		  [% END %]

		  [% IF inagroup %]
			<div id="bz_enable_role_visibility_help">
			  <b>Users in the roles selected below can always view 
				this [% terms.bug %]:</b>
			</div>
			<div id="bz_enable_role_visibility">
			  <div>
				[% user_can_edit_accessible = 
				  bug.check_can_change_field("reporter_accessible", 0, 1) 
				%]
				[% IF user_can_edit_accessible %]
				  <input type="hidden" name="defined_reporter_accessible" value="1">
				[% END %]
				<input type="checkbox" value="1"
					   name="reporter_accessible" id="reporter_accessible"
					   [% " checked" IF bug.reporter_accessible %]
					   [% " disabled=\"disabled\"" UNLESS user_can_edit_accessible %]>
				<label for="reporter_accessible">Reporter</label>
			  </div>
			  <div>
				[% user_can_edit_accessible = 
				  bug.check_can_change_field("cclist_accessible", 0, 1) 
				%]
				[% IF user_can_edit_accessible %]
				  <input type="hidden" name="defined_cclist_accessible" value="1">
				[% END %]
				<input type="checkbox" value="1"
					   name="cclist_accessible" id="cclist_accessible"
					   [% " checked" IF bug.cclist_accessible %]
					   [% " disabled=\"disabled\"" UNLESS user_can_edit_accessible %]>
				<label for="cclist_accessible">CC List</label>
			  </div>
			  <p class="instructions">
				The assignee
				[% IF (Param('useqacontact')) %]
				   and QA contact
				[% END %]
				can always see [% terms.abug %], and this section does not
				take effect unless the [% terms.bug %] is restricted to at
				least one group.
			  </p>
			</div>
		[% END %]
	[% END %]
	
	[%############################################################################%]
	[%# END Block for Restricting Visibility                                      #%]
	[%############################################################################%]

	[%############################################################################%]
	[%# Block for Timetracking (collapsible)                                     #%]
	[%############################################################################%]

	[% BLOCK section_timetracking %]
		[% IF user.is_timetracker %]
			<div class="responsive-table bz_time_tracking_table">
				<div class="responsive-tr responsive-th-hidden">
					<div class="responsive-th">
						[% INCLUDE "bug/field-label.html.tmpl"
							field = bug_fields.estimated_time, editable = 1
						%]
					</div>
					<div class="responsive-th">
						<span class="field_label">Current Est.:</span>
					</div>
					<div class="responsive-th">
						[% INCLUDE "bug/field-label.html.tmpl"
						   field = bug_fields.work_time, editable = 1
						%]
					</div>
					<div class="responsive-th">
						[% INCLUDE "bug/field-label.html.tmpl"
						  field = bug_fields.remaining_time, editable = 1
						%]
					</div>
					<div class="responsive-th">
						[% INCLUDE "bug/field-label.html.tmpl"
						   field = bug_fields.percentage_complete
						%]
					</div>
					<div class="responsive-th">
					  <span class="field_label">Gain:</span>
					</div>
				</div>
				<div class="responsive-tr">
				   <div class="responsive-td bug-field-grid">
						<span class="list-label">
							[% INCLUDE "bug/field-label.html.tmpl"
								field = bug_fields.estimated_time, editable = 1
							%]
					    </span>
					    <input name="estimated_time" id="estimated_time"
						   value="[% PROCESS formattimeunit
											 time_unit=bug.estimated_time %]"
							size="6" maxlength="6"
						>
					</div>
					<div class="responsive-td bug-field-grid">
						<span class="list-label">
						  <label class="field_label">Current Est.:</label>
						</span>
						[% PROCESS formattimeunit
						   time_unit=(bug.actual_time + bug.remaining_time) %]
					</div>
					<div class="responsive-td bug-field-grid">
						<span class="list-label">
						   [% INCLUDE "bug/field-label.html.tmpl"
							field = bug_fields.work_time, editable = 1
						   %]
						</span>
						[% PROCESS formattimeunit time_unit=bug.actual_time %] +
						<input name="work_time" id="work_time"
						   value="0" size="3" maxlength="6"
						   onchange="adjustRemainingTime();"
						>
					</div>
					<div class="responsive-td bug-field-grid">
						<span class="list-label">
							[% INCLUDE "bug/field-label.html.tmpl"
								field = bug_fields.remaining_time, editable = 1
							%]
						</span>
						<input name="remaining_time" id="remaining_time"
						   value="[% PROCESS formattimeunit
									 time_unit=bug.remaining_time %]"
						   size="6" maxlength="6" onchange="updateRemainingTime();"
						>
							</div>
					<div class="responsive-td bug-field-grid">
						<span class="list-label">
							[% INCLUDE "bug/field-label.html.tmpl"
								field = bug_fields.percentage_complete
							%]
						</span>
						[% PROCESS calculatepercentage act=bug.actual_time
							   rem=bug.remaining_time %]
					</div>
					<div class="responsive-td bug-field-grid">
						<span class="list-label">
							<label class="field_label">Gain:</label>
						</span>
							[% PROCESS formattimeunit time_unit=bug.estimated_time - (bug.actual_time + bug.remaining_time) %]
					</div>       
				</div>
			</div>
			<div class="bug-field-grid bz_summarize_time">
				<a href="summarize_time.cgi?id=[% bug.bug_id %]&amp;do_depends=1">
				Summarize time (including time for [% terms.bugs %]
				blocking this [% terms.bug %])</a>
			</div>			  
		[% END %]
	[% END %]	  

	[%############################################################################%]
	[%# END Block for Timetracking                                               #%]
	[%############################################################################%]

	[%############################################################################%]
	[%# Block for the Title (alias and short desc)                               #%]
	[%############################################################################%]

	[% BLOCK section_title %]
	  [%# That's the main table, which contains all editable fields. %]
	  <div class="bz_short_desc_container edit_form">
		  [% PROCESS commit_button id="_top"%]
		 <a href="show_bug.cgi?id=[% bug.bug_id %]">
			[%-# %]<b>[% terms.Bug %]&nbsp;[% bug.bug_id FILTER html %]</b>
		 [%-# %]</a> <span id="summary_container" class="bz_default_hidden">
		  [% IF bug.alias.size > 0 %]
			(<span id="alias_nonedit_display">[% bug.alias.join(', ') FILTER html %]</span>)
		  [% END %]
		  - <span id="short_desc_nonedit_display">[% bug.short_desc FILTER quoteUrls(bug) %]</span>
		  [% can_edit_short_desc = bug.check_can_change_field('short_desc', 0, 1) %]
		  [% IF can_edit_short_desc %]
			<small>(<a href="#" id="summary_edit_action">edit</a>)</small>
		  [% END %]
		 </span>

		<div id="summary_input">
		  [% INCLUDE "bug/field-label.html.tmpl"
			field = bug_fields.short_desc
			editable = can_edit_short_desc
			accesskey = "s"
			tag_name = 'span'
		  %]
		  [% PROCESS input inputname => "short_desc" size => "80"
						   maxlength => 255 spellcheck => "true" no_td => 1 %]
		</div>
	  </div>
	  <script type="text/javascript">
		hideEditableField('summary_container',
						  'summary_input',
						  'summary_edit_action',
						  'short_desc',
						  '[% bug.short_desc FILTER js %]' );
	  </script>
	[% END %]

	[%############################################################################%]
	[%# Block for the Product/unit and classification                            #%]
	[%############################################################################%]

	[% BLOCK section_product %]
		  [% INCLUDE bug/field.html.tmpl
			  bug = bug, field = bug_fields.product, value = bug.product
			  override_legal_values = bug.choices.product
			  desc_url = "describecomponents.cgi"
			  editable = bug.check_can_change_field('product', 0, 1)
		  %]
		[%# Classification is here so that it can be used in value controllers
		  # and visibility controllers. It comes after product because
		  # it uses some javascript that depends on the existence of the
		  # product field.
		  #%]
		</div>
		<div class="bug-field-grid bz_default_hidden bz_field_lmb_not_broken">
		   [% INCLUDE bug/field.html.tmpl
				bug = bug field = bug_fields.classification
				override_legal_values = bug.choices.classification
				value = bug.classification
				editable = bug.check_can_change_field('product', 0, 1) %]
	[% END %]

	[%############################################################################%]
	[%# Block for Component                                                      #%]
	[%############################################################################%]

	[% BLOCK section_component %]

			[%# It MUST come after product because
			# it uses some javascript that depends on the existence of the
			# product field.
			#%]
			[% INCLUDE bug/field.html.tmpl
				bug = bug, field = bug_fields.component, value = bug.component
				override_legal_values = bug.choices.component
				desc_url = "describecomponents.cgi?product=$bug.product"
				editable = bug.check_can_change_field('component', 0, 1)
			%]

	[% END %]

	[%############################################################################%]
	[%# Block for Ops System                                                     #%]
	[%############################################################################%]

	[% BLOCK section_opsys %] 

			[% INCLUDE "bug/field-label.html.tmpl"
				field = bug_fields.op_sys,
				editable = op_sys,
				accesskey = "j" %]
			[%+ INCLUDE bug/field.html.tmpl
				bug = bug, field = bug_fields.op_sys, 
				no_tds = 1, value = bug.op_sys
				editable = bug.check_can_change_field('op_sys', 0, 1) %]

	[% END %]

	[%############################################################################%]
	[%# Block for Version                                                        #%]
	[%############################################################################%]

	[% BLOCK section_version %]
	
		  [% INCLUDE "bug/field-label.html.tmpl"
			  field = bug_fields.version
			  editable = bug.check_can_change_field('version', 0, 1) %]

		  [% PROCESS select selname => "version" %]

	[% END %]

	[%############################################################################%]
	[%# Block for the PLATFORM/Claim Category                                    #%]
	[%############################################################################%]

	[% BLOCK section_platform %]
			[% can_edit_rep_platform = bug.check_can_change_field('rep_platform', 0, 1) %]

				[% INCLUDE "bug/field-label.html.tmpl"
					field = bug_fields.rep_platform,
					editable = can_edit_rep_platform,
					accesskey = "h" %]
				[% INCLUDE bug/field.html.tmpl
					bug = bug, field = bug_fields.rep_platform,
					no_tds = 1, value = bug.rep_platform
					editable = can_edit_rep_platform %]

	[% END %]

	[%############################################################################%]
	[%# Block for the status section                                             #%]
	[%############################################################################%]

	[% BLOCK section_status %]
		<span class="field_label">
		  <label><a href="page.cgi?id=fields.html#bug_status">Status:</a></label>
		</span>
		<span id="bz_field_status">
		  <span id="static_bug_status">
			[% display_value("bug_status", bug.bug_status) FILTER html %]
			[% IF bug.resolution %]
			  [%+ display_value("resolution", bug.resolution) FILTER html %]
			  [% IF bug.dup_id %]
				of [% "${terms.bug} ${bug.dup_id}" FILTER bug_link(bug.dup_id) FILTER none %]
			  [% END %]
			[% ELSIF bug.bug_status == "IN_PROGRESS" && bug.cf_ipi_clust_4_status_in_progress != "---" %]
			  [%+ display_value("progression", bug.cf_ipi_clust_4_status_in_progress) FILTER html %]
			[% ELSIF bug.bug_status == "STAND BY" && bug.cf_ipi_clust_4_status_standby != "---" %]
			  [%+ display_value("stand_by_cause", bug.cf_ipi_clust_4_status_standby) FILTER html %]
			[% END %]
			[% IF bug.user.canedit || bug.user.isreporter %]
			  (<a href="#add_comment" 
				  onclick="window.setTimeout(function() { document.getElementById('bug_status').focus(); }, 10)">edit</a>)
			[% END %]
		  </span>
		</span>
	[% END %]

	[%############################################################################%]
	[%# Block for Importance                                                     #%]
	[%############################################################################%]

	[% BLOCK section_importance %]
		  <span>
			[% can_edit_priority = bug.check_can_change_field('priority', 0, 1) %]
			<label [% IF can_edit_priority %]for="priority"[% END %] accesskey="i" class="field_label">
			  <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance:</a></label>
		  </span>
		   [% INCLUDE bug/field.html.tmpl
				bug = bug, field = bug_fields.priority,
				no_tds = 1, value = bug.priority
				editable = can_edit_priority %]
		   [%+ INCLUDE bug/field.html.tmpl
				bug = bug, field = bug_fields.bug_severity,
				no_tds = 1, value = bug.bug_severity
				editable = bug.check_can_change_field('bug_severity', 0, 1) %]
			[% Hook.process('after_importance', 'bug/edit.html.tmpl') %]
	[% END %]

	[%############################################################################%]
	[%# Block for the target milestone                                           #%]
	[%############################################################################%]

	[% BLOCK section_target_milestone %]
		[% IF Param("usetargetmilestone") && bug.target_milestone %]
		  <div class="bug-field-grid">
			[% INCLUDE "bug/field-label.html.tmpl"
			  field = bug_fields.target_milestone
			  editable = bug.check_can_change_field('target_milestone', 0, 1)
			%]
			[% PROCESS select selname = "target_milestone" %]
		  </div>
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for the status deadline                                            #%]
	[%############################################################################%]

	[% BLOCK section_deadline %] 
		[% IF Param("timetrackinggroup") && bug.deadline %]
		<span class="field_label">
		  [% INCLUDE "bug/field-label.html.tmpl"
			 field = bug_fields.deadline, editable = 1
		  %]
		</span>
		[% INCLUDE bug/field.html.tmpl
		  field = bug_fields.deadline, value = bug.deadline, no_tds = 1
		  editable = bug.check_can_change_field('deadline', 0, 1) %]
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for the table in the "People" section                              #%]
	[%############################################################################%]

	[% BLOCK section_people %]
			[% can_edit_assigned_to = bug.check_can_change_field("assigned_to", 0, 1) %]
			[% INCLUDE "bug/field-label.html.tmpl"
				field = bug_fields.assigned_to
				editable = can_edit_assigned_to
			%]
			[% IF can_edit_assigned_to %]
				<div id="bz_assignee_edit_container" class="bz_default_hidden field_value">
					[% INCLUDE global/user.html.tmpl who = bug.assigned_to %]
					(<a href="#" id="bz_assignee_edit_action">edit</a>)
					[% IF bug.assigned_to.id != user.id %]
					(<a title="Reassign to yourself" href="#" id="bz_assignee_take_action">take</a>)
					[% END %]
				</div>
				<div id="bz_assignee_input" class="field_value">
					[% INCLUDE global/userselect.html.tmpl
						id => "assigned_to"
						name => "assigned_to"
						value => bug.assigned_to.login
						classes => ["bz_userfield"]
						size => 30
					%]
					<br>
					<input type="checkbox" id="set_default_assignee" name="set_default_assignee" value="1">
					<span id="set_default_assignee_label" for="set_default_assignee">
						Reset Assignee to default
					</span>
				</div>
				<script type="text/javascript">
					hideEditableField('bz_assignee_edit_container', 
							   'bz_assignee_input', 
							   'bz_assignee_edit_action', 
							   'assigned_to', 
							   '[% bug.assigned_to.login FILTER js %]' );
					hideEditableField('bz_assignee_edit_container',
							   'bz_assignee_input',
							   'bz_assignee_take_action',
							   'assigned_to',
							   '[% bug.assigned_to.login FILTER js %]',
							   '[% user.login FILTER js %]' );
					initDefaultCheckbox('assignee');                  
				</script>
			[% ELSE %]
			[% INCLUDE global/user.html.tmpl who = bug.assigned_to %]
			[% END %]
		[% IF Param('useqacontact') %]
		</div>
		[%##################################################################################################################%]
		[%# we add a closing div here because IF the condition is TRUE then we need to close the div from the previous div #%]
		[%# this div was opened for the assignee                                                                           #%]
		[%# If the condition is FALSE, we will close the previously opened div as per normal as we process this section    #%]
		[%##################################################################################################################%]
		
		<div class="bug-field-grid">
			[% can_edit_qa_contact = bug.check_can_change_field("qa_contact", 0, 1) %]
			[% INCLUDE "bug/field-label.html.tmpl"
				field = bug_fields.qa_contact
				editable = can_edit_qa_contact
				accesskey = "q"
			%]
			[% IF can_edit_qa_contact %]
			<div id="bz_qa_contact_edit_container" class="bz_default_hidden field_value">
				<span>
					[% INCLUDE global/user.html.tmpl who = bug.qa_contact %]
					(<a href="#" id="bz_qa_contact_edit_action">edit</a>)
					[% IF bug.qa_contact.id != user.id %]
					(<a title="Change QA contact to yourself" href="#" id="bz_qa_contact_take_action">take</a>)
					[% END %]
				</span>
			</div>
			<div id="bz_qa_contact_input" class="field_value">
				[% INCLUDE global/userselect.html.tmpl
					id      => "qa_contact"
					name    => "qa_contact"
					value   => bug.qa_contact.login
					size    => 30
					classes => ["bz_userfield"]
					emptyok => 1
				%]
				<br>
				<input type="checkbox" id="set_default_qa_contact" name="set_default_qa_contact" value="1">
				<span for="set_default_qa_contact" id="set_default_qa_contact_label">
					Reset QA Contact to default
				</span>
			</div>
			<script type="text/javascript">
				hideEditableField('bz_qa_contact_edit_container', 
								'bz_qa_contact_input', 
								'bz_qa_contact_edit_action', 
								'qa_contact', 
								'[% bug.qa_contact.login FILTER js %]');
				hideEditableField('bz_qa_contact_edit_container', 
								'bz_qa_contact_input', 
								'bz_qa_contact_take_action', 
								'qa_contact', 
								'[% bug.qa_contact.login FILTER js %]',
								'[% user.login FILTER js %]');
				initDefaultCheckbox('qa_contact');
			</script>
			[% ELSE %]
			[% INCLUDE global/user.html.tmpl who = bug.qa_contact %]
			[% END %]
		[% END %]
		<script type="text/javascript">
		  assignToDefaultOnChange(['product', 'component'],
			'[% bug.component_obj.default_assignee.login FILTER js %]',
			'[% bug.component_obj.default_qa_contact.login FILTER js %]');
		</script>
	[% END %]

	[%############################################################################%]
	[%# Block for URL                                                            #%]
	[%############################################################################%]

	[% BLOCK section_url %]
		<div class="bug-field-grid">
			[% can_edit_bug_file_loc = bug.check_can_change_field("bug_file_loc", 0, 1) %]
			[% INCLUDE "bug/field-label.html.tmpl"
				field = bug_fields.bug_file_loc
				editable = can_edit_bug_file_loc
				accesskey = "u"
			%]
			[% IF can_edit_bug_file_loc %]
			<div id="bz_url_edit_container" class="bz_default_hidden field_value"> 
				[% IF is_safe_url(bug.bug_file_loc) %]
					<a href="[% bug.bug_file_loc FILTER html %]" target="_blank" rel="noreferrer" title="[% bug.bug_file_loc FILTER html %]">
						[% bug.bug_file_loc FILTER truncate(30) FILTER html %]
					</a>
				[% ELSE %]
					[% bug.bug_file_loc FILTER html %]
				[% END %]
				(<a href="#" id="bz_url_edit_action">edit</a>)
			</div>
			[% END %]
			<div id="bz_url_input_area" class="field_value">
				[% url_output = INCLUDE input no_td = 1 inputname = "bug_file_loc" size = 30 %]
				[% IF NOT bug.check_can_change_field("bug_file_loc", 0, 1)
					AND is_safe_url(bug.bug_file_loc) %]
					<a href="[% bug.bug_file_loc FILTER html %]"rel="noreferrer">
						[% url_output FILTER none %]
					</a>
				[% ELSE %]
					[% url_output FILTER none %]
				[% END %]
			</div>
			[% IF bug.check_can_change_field("bug_file_loc", 0, 1) %]
				<script type="text/javascript">
					hideEditableField('bz_url_edit_container', 
							  'bz_url_input_area', 
							  'bz_url_edit_action', 
							  'bug_file_loc', 
							  "[% bug.bug_file_loc FILTER js %]");
				</script>
			[% END %]
		</div>
	[% END %]

	[%############################################################################%]
	[%# Block for Keyword                                                        #%]
	[%############################################################################%]

	[% BLOCK section_keyword %]
		[% IF Param('usestatuswhiteboard') %]
		<div class="bug-field-grid">
			[% INCLUDE "bug/field-label.html.tmpl"
				field = bug_fields.status_whiteboard
				editable = bug.check_can_change_field("status_whiteboard", 0, 1)
				accesskey = "w"
			%]
			[% INCLUDE input inputname = "status_whiteboard" size = 30 %]
		</div>
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Whiteboard                                                     #%]
	[%############################################################################%]

	[% BLOCK section_whiteboard %]
		[% IF use_keywords %]
		<div class="bug-field-grid">
			[% INCLUDE bug/field.html.tmpl
				bug = bug, field = bug_fields.keywords, value = bug.keywords
				editable = bug.check_can_change_field("keywords", 0, 1),
				desc_url = "describekeywords.cgi", possible_values = all_keywords
			%]
		</div>
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Tags                                                           #%]
	[%############################################################################%]

	[% BLOCK section_tags %]
		[% IF user.id %]
		<div class="bug-field-grid">
			[% INCLUDE bug/field.html.tmpl
				bug = bug, field = bug_fields.tag, value = bug.tags.join(", "),
				editable = 1, possible_values = user.tags.keys
			%]
		</div>
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Duplicates                                                     #%]
	[%############################################################################%]

	[% BLOCK section_duplicates %]
		[% RETURN UNLESS bug.duplicates.size %]
		<div class="bug-field-grid">
			<span class="field-label">
				<label>
					Duplicates ([% bug.duplicates.size %])
				</label>:
			</span>
			<span class="field_value">
				<span id="duplicates">
					[% FOREACH dupe = bug.duplicates %]
						[% INCLUDE bug/link.html.tmpl bug = dupe, link_text = dupe.id, use_alias = 1 %][% " " %]
					[% END %]
				</span>
				(<a href="buglist.cgi?bug_id=[% bug.duplicate_ids.join(",") FILTER html %]">[%-%]view as [% terms.bug %] list</a>)
			</span>
		</div>
	[% END %]

	[%############################################################################%]
	[%# Block for Depends On                                                     #%]
	[%############################################################################%]

	[% BLOCK section_dependson %]
			[% INCLUDE dependencies 
				field = bug_fields.dependson deps = bug.depends_on_obj %]
	[% END %]

	[%############################################################################%]
	[%# Block for Blocks                                                         #%]
	[%############################################################################%]

	[% BLOCK section_blocks %]
			[% INCLUDE dependencies 
				field = bug_fields.blocked deps = bug.blocks_obj %]
	[% END %]

	[%############################################################################%]
	[%# Block for dependency tree                                                #%]
	[%############################################################################%]

	[% BLOCK section_dependency %]
		[% IF bug.dependson.size || bug.blocked.size %]
				<span id="show_dependency_tree_or_graph">
					Show dependency <a href="showdependencytree.cgi?id=[% bug.bug_id %]&amp;hide_resolved=1">tree</a>
				[% IF Param('webdotbase') %]
				  /&nbsp;<a href="showdependencygraph.cgi?id=[% bug.bug_id %]">graph</a>
				[% END %]
				</span>
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Dates                                                          #%]
	[%############################################################################%]

	[% BLOCK section_dates %]
			<label class="field_label">
				Reported:
			</label>
			[% bug.creation_ts FILTER time("%Y-%m-%d %H:%M %Z") %] by [% INCLUDE global/user.html.tmpl who = bug.reporter %]
		</div>
		<div class="bug-field-grid bz_field_modified">
			<label class="field_label">
				Modified:
			</label>
			[% bug.delta_ts FILTER time("%Y-%m-%d %H:%M %Z") %]
			(<a href="show_activity.cgi?id=[% bug.bug_id %]">[%# terms.Bug %]History</a>)  
	[% END %]

	[%############################################################################%]
	[%# Block for CC LIST                                                        #%]
	[%############################################################################%]
	
	[% BLOCK section_cclist %]
			<label [% IF user.id %]for="newcc"[% END %] accesskey="a" class="field_label">
				CC List:
			</label>
			[% IF user.id %]
				[% IF NOT bug.cc.contains(user.login) %]
				<input type="checkbox" id="addselfcc" name="addselfcc"
					[% " checked=\"checked\""
						IF user.settings.state_addselfcc.value == 'always'
							|| (!bug.user.has_any_role
								&& user.settings.state_addselfcc.value == 'cc_unless_role') %]>
					<span for="addselfcc">Add me to CC list
					</span>
					<br>
				[% END %]
			[% END %]
			[% bug.cc.size FILTER html %] 
			[% IF bug.cc.size == 1 %]
				user
			[% ELSE %]
				users
			[% END %]
			[% IF user.id %]
				[% IF bug.cc.contains( user.email ) %]
				including you
				[% END %]
			[% END %]
			[% IF user.id || bug.cc.size %]
				<span id="cc_edit_area_showhide_container" class="bz_default_hidden">
				(<a href="#" id="cc_edit_area_showhide">[% IF user.id %]edit[% ELSE %]show[% END %]</a>)
				</span>
			[% END %]
			<div id="cc_edit_area">
				<br>
				[% IF user.id %]
					<div class="bug-field-grid">
						<label for="cc" class="field_label">
							<b>Add</b>
						</label>
						<div class="field_value">
							[% INCLUDE global/userselect.html.tmpl
								id => "newcc"
								name => "newcc"
								value => ""
								size => 30
								classes => ["bz_userfield", "text_input"]
								multiple => 5
							%]
						</div>
					</div>
				[% END %]
				[% IF bug.cc.size %]
					<select id="cc" multiple="multiple" size="5" [% 'name="cc"' IF bug.user.canedit %] class="field_value">
						[% FOREACH c = bug.cc %]
						<option value="[% c FILTER email FILTER html %]">
						[% c FILTER email FILTER html %]
						</option>
					</select>
				[% END %]					
				[% IF user.id && !bug.user.canedit %]
					<input type="hidden" name="cc" value="[% user.login FILTER email FILTER html %]" class="field_value">
				[% END %]
				[% IF user.id AND (bug.user.canedit OR bug.cc.contains(user.login)) %]
					<br>
					<input type="checkbox" id="removecc" name="removecc">
						<span for="removecc">
						[% IF bug.user.canedit %]
							Remove selected CCs
						[% ELSE %]
							Remove me from the CC list
						[% END %]
						</span>
					<br>
				[% END %]
			[% END %]
			</div>
			[% IF user.id || bug.cc.size %]
				<script type="text/javascript">
					hideEditableField( 'cc_edit_area_showhide_container', 
								 'cc_edit_area', 
								 'cc_edit_area_showhide', 
								 '', 
								 '');  
				</script>
			[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Bug Ignored                                                    #%]
	[%############################################################################%]
	
	[% BLOCK section_bug_ignored %]
		[% IF user.id %]
			<div class="bug-field-grid">
				<label for="bug_ignored" class="field_label" title="Ignore all email for this [% terms.bug %]">
					Ignore [% terms.Bug %] Mail:
				</label>
				<input type="hidden" name="defined_bug_ignored" value="1">
				<span title="You will still receive emails for flag requests directed at you.">
					<input type="checkbox" name="bug_ignored" id="bug_ignored" value="1"
						[% ' checked="checked"' IF user.is_bug_ignored(bug.id) %]>
					(never email me about this [% terms.bug %])
				</span>
			</div>
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for See Also                                                       #%]
	[%############################################################################%]
		
		[% BLOCK section_see_also %]
		  [% IF Param('use_see_also') || bug.see_also.size %]
			<div class="bug-field-grid">
			  [% INCLUDE bug/field.html.tmpl 
				   field    = bug_fields.see_also
				   value    = bug.see_also
				   editable = bug.check_can_change_field('see_also', 0, 1)
			  %]
			</div>
		  [% END %]
		[% END %]

	[%############################################################################%]
	[%# Block for Aliases                                                        #%]
	[%############################################################################%]

	[% BLOCK section_aliases %]
			[% INCLUDE "bug/field-label.html.tmpl" field = bug_fields.alias %]
			[% IF bug.alias.size %]
			[% bug.alias.join(', ') FILTER html %]
			[% ELSE %]
			None
			[% END %]
			[% IF bug.check_can_change_field('alias', 0, 1) %]
				<span id="alias_edit_area_showhide_container" class="bz_default_hidden">
					(<a href="#" id="alias_edit_area_showhide">edit</a>)
				</span>
				<br>
			<div id="alias_edit_area">
				<div>
					<label for="newalias" class="field_label">Add</label>
				<br>
				<input name="newalias" id="newalias" size="20">
				</div>
				[% IF bug.alias.size %]
				<select id="alias" name="alias" multiple="multiple" size="5">
					[% FOREACH a = bug.alias %]
						<option value="[% a FILTER html %]">[% a FILTER html %]</option>
				[% END %]
				</select>
				<br>
				
				<input type="checkbox" id="removealias" name="removealias">
				<label for="removealias">Remove selected aliases</label>
			[% END %]
			</div>
			<script type="text/javascript">
				hideEditableField( 'alias_edit_area_showhide_container',
							   'alias_edit_area',
							   'alias_edit_area_showhide',
							   '',
							   '');
			</script>
			[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for FLAGS                                                          #%]
	[%############################################################################%]

	[% BLOCK section_flags %]
		[%# *** Flags *** %]
		[% show_bug_flags = 0 %]
		[% bug_flags_set = 0 %]
		[% show_more_flags = 0 %]
		[% FOREACH type = bug.flag_types %]
		[% IF type.flags.size || (user.id && type.is_active && user.can_request_flag(type)) %]
			[% show_bug_flags = 1 %]
		[% END %]
		[% IF user.id && type.is_active && (!type.flags.size || type.is_multiplicable) %]
			[% show_more_flags = 1 %]
		[% END %]
		[% IF type.flags.size %]
			[% bug_flags_set = 1 %]
		[% END %]
		[% LAST IF show_bug_flags && show_more_flags && bug_flags_set %]
		[% END %]
		[% IF show_bug_flags %]
				<span class="field_label">
					<label>Flags:</label>
				</span>
				[% IF bug.flag_types.size %]
					[% PROCESS "flag/list.html.tmpl" flag_no_header = 1
												 flag_types = bug.flag_types
												 any_flags_requesteeble = bug.any_flags_requesteeble %]
				[% END %]
				[% IF show_more_flags %]
					<span id="bz_flags_more_container" class="bz_default_hidden">
						[% IF !bug_flags_set %]<em>None yet set</em>[% END %]
						(<a href="#" id="bz_flags_more_action">[% IF !bug_flags_set %]set[% ELSE %]more[% END %] flags</a>)
					</span>
					<script type="text/javascript">
						YAHOO.util.Dom.removeClass('bz_flags_more_container', 'bz_default_hidden');
						var table = YAHOO.util.Dom.get("flags");
						var rows = YAHOO.util.Dom.getElementsByClassName('bz_flag_type', 'tbody', table);
						for (var i = 0; i < rows.length; i++) {
							YAHOO.util.Dom.addClass(rows[i], 'bz_default_hidden');
							}
						YAHOO.util.Event.addListener('bz_flags_more_action', 'click', function (e) {
							YAHOO.util.Dom.addClass('bz_flags_more_container', 'bz_default_hidden');
							for (var i = 0; i < rows.length; i++) {
								YAHOO.util.Dom.removeClass(rows[i], 'bz_default_hidden');
							}
							YAHOO.util.Event.preventDefault(e);
						}); 
					</script>
			  [% END %]
		[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Custom Fields                                                  #%]
	[%############################################################################%]

	[% BLOCK section_customfields %]
	[%# *** Custom Fields *** %]
	  [% USE Bugzilla %]
	  [% FOREACH field = Bugzilla.active_custom_fields %]
		[% IF NOT field.name.search('clust') %]
		  <div class="bug-field-grid [%- field.name %]">
			[%# Use PROCESS instead of INCLUDE, because extra_field_item is defined
			  # in the template and must be returned back. INCLUDE cannot do that. %]
			[% PROCESS bug/field.html.tmpl value = bug.${field.name}
										   editable = bug.check_can_change_field(field.name, 0, 1) %]
		  </div>
		  [% IF extra_field_item %]
			<div class="bug-field-grid">
			  <span class="field_label">[% extra_field_item.header FILTER none %]</span>
			  [% extra_field_item.data FILTER none %]
			</div>
		  [% END %]
		[% END %]
	  [% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for Section Spacer                                                 #%]
	[%############################################################################%]

	[% BLOCK section_spacer %]
	  <div class="bug-field-grid">
		
	  </div>
	[% END %]


	[%############################################################################%]
	[%# Block for dependencies                                                   #%]
	[%############################################################################%]

	[% BLOCK dependencies %]

	  [% INCLUDE "bug/field-label.html.tmpl" %]

	  <div id="[% field.name FILTER html %]_input_area" class="field_value">
		[% IF bug.check_can_change_field(field.name, 0, 1) %]
		  <input name="[% field.name FILTER html %]" 
				 id="[% field.name FILTER html %]" class="text_input"
				 value="[% bug.${field.name}.join(', ') FILTER html %]">
		[% END %]
	  </div>

	  [% FOREACH dep_bug = deps %]
		[% INCLUDE bug/link.html.tmpl bug = dep_bug, link_text = dep_bug.id, use_alias = 1 %][% " " %]
	  [% END %]
	  [% IF bug.check_can_change_field(field.name, 0, 1) %]
		<span id="[% field.name FILTER html %]_edit_container" 
			  class="edit_me bz_default_hidden">
		  (<a href="#" id="[% field.name FILTER html %]_edit_action">edit</a>)
		</span>
		<script type="text/javascript">
		  hideEditableField('[% field.name FILTER js %]_edit_container', 
							'[% field.name FILTER js %]_input_area', 
							'[% field.name FILTER js %]_edit_action', 
							'[% field.name FILTER js %]', 
							'[% bug.${field.name}.join(', ') FILTER js %]');
		</script>
	  [% END %]
	  
	[% END %]

	[%############################################################################%]
	[%# Block for the Additional Comments box                                    #%]
	[%############################################################################%]

	[% BLOCK comment_box %]
			[% IF user.id %]
			<label for="comment" accesskey="c" class="field_label">
				<b>Additional <u>C</u>omments</b>:
			</label>
			
			[% IF user.is_insider && bug.check_can_change_field('longdesc', 0, 1) %]
			<input type="checkbox" name="comment_is_private" value="1"
				   id="newcommentprivacy"
				   onClick="updateCommentTagControl(this, 'comment')">
			<label for="newcommentprivacy">
				Make comment private (visible only to members of the <strong>[% Param('insidergroup') FILTER html %]</strong> group)
			</label>
			[% END %]
			
			<div class="bug-field-grid">
				[% IF bug.check_can_change_field('longdesc', 0, 1) %]
					[% INCLUDE bug/comment.html.tmpl
						 minrows   = 10
						 maxrows   = 25
						 cols      = constants.COMMENT_COLS
					%]
				[% IF user.is_insider %]
				<script>
				   updateCommentTagControl(document.getElementById('newcommentprivacy'), 'comment');
				</script>
				[% END %]
				[% Hook.process("after_comment_textarea", 'bug/edit.html.tmpl') %]
				[% ELSE %]
				You are not allowed to make an additional comment on this [% terms.bug %].
				[% END %]
			</div>
			<div class="bug-field-grid">
				<div id="bug_status_bottom" class="status">
					<div class="bug-field-grid bz_field_status">
						<span class="field_label">
							<a href="page.cgi?id=fields.html#bug_status">Status</a>:
						</span>
						[%# By default, it is PROCESS, but there is a weird behavior in PROCESS which seems to affect the next immediate field. So we decided to use INCLUDE as workaround. Need to understand how both PROCESS and INCLUDE work. %]
						[% INCLUDE bug/knob.html.tmpl %]
						[% PROCESS section_customfields_with_keyword_clust_4 %]
					</div>
				</div>
			</div>
			<div class="bug-field-grid">
				[% PROCESS commit_button id=""%]
				[% Hook.process("after_comment_commit_button", 'bug/edit.html.tmpl') %]
			</div>
			[%# For logged-out users %]
			[% ELSE %]
				<div class="bug-field-grid">
					<fieldset>
						<span>
							<b>Note:</b>
						</span>
						You need to <a href="show_bug.cgi?id=[%- bug.bug_id %]&amp;GoAheadAndLogIn=1">log in</a> before you can comment on or make changes to this [% terms.bug %].
					</fieldset>
				</div>
			[% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for SELECT fields                                                  #%]
	[%############################################################################%]

	[% BLOCK select %]
	  [% IF bug.check_can_change_field(selname, 0, 1) 
			AND bug.choices.${selname}.size > 1 %]
		<input type="hidden" id="[% selname %]_dirty">
		<select id="[% selname %]" name="[% selname %]">
		  [% FOREACH x = bug.choices.${selname} %]
			<option value="[% x.name FILTER html %]"
			  [% " selected" IF x.name == bug.${selname} %]>
			  [%- x.name FILTER html %]
			</option>
		  [% END %]
		</select>
	  [% ELSE %]
		[% bug.${selname} FILTER html %]
	  [% END %]
	[% END %]

	[%############################################################################%]
	[%# Block for INPUT fields                                                   #%]
	[%############################################################################%]

	[% BLOCK input %]
	  [% IF no_td != 1 %]
	  <span>
	  [% END %]
		[% val = value ? value : bug.$inputname %]
		[% IF bug.check_can_change_field(inputname, 0, 1) %]
		   <input id="[% inputname %]" name="[% inputname %]" class="text_input"
				  value="[% val FILTER html %]"[% " size=\"$size\"" IF size %]
				  [% " maxlength=\"$maxlength\"" IF maxlength %]
				  [% " spellcheck=\"$spellcheck\"" IF spellcheck %]>
		[% ELSE %]
		  [% IF size && val.length > size %]
			<span title="[% val FILTER html %]">
			  [% val FILTER truncate(size) FILTER html %]
			</span>
		  [% ELSE %]
			[% val FILTER html %]
		  [% END %]
		[% END %]
	  [% IF no_td != 1 %]  
	  </span>
	  [% END %]
	  [% no_td = 0 %]
	  [% maxlength = 0 %]
	  [% colspan = 0 %]
	  [% size = 0 %]
	  [% value = undef %]
	  [% spellcheck = undef %]
	[% END %]

	[% BLOCK commit_button %]
	  [% IF user.id %]
		<div class="knob-buttons">
		  <input type="submit" value="Save Changes" 
				 id="commit[% id FILTER css_class_quote %]">
		</div>
	  [% END %]
	[% END %]

[%############################################################################%]
[%# END - Definition of blocks that we need                                  #%]
[%############################################################################%]	

